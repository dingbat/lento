(this.webpackJsonplento=this.webpackJsonplento||[]).push([[0],{102:function(n,e,t){"use strict";t.r(e);var r=t(6),a=t.n(r),i=t(37),o=t.n(i),s=(t(45),t(2)),c=t.n(s),u=t(3),l=t(4),m=t(23),p=t(5),h=t(15),d=t.n(h).a.grammar('Lento {\n  Composition = newline* Statement*\n  Statement = (set | Section) (newline+ | end)\n\n  set = "set" spaces ("bpm" | "key") spaces "to" spaces alnum+\n\n  Section = Instrument | Arrangement\n\n  Instrument = instrumentHeader (newline+ TrackList)?\n  instrumentHeader = spaces ident "/" ident spaces\n  TrackList = track (newline+ track)*\n  track = "|" ((~("|" | newline) any)* "|")*\n\n  Arrangement = arrangementHeader (newline+ CommandList)?\n  arrangementHeader = spaces ident "/"\n  CommandList = Command (newline+ Command)*\n  Command = Loop | Play\n  Loop = "loop" Fragment\n  Play = "play" Fragment (digit+ "times")? InlineThen? (newline+ BlockThen)?\n  InlineThen = "then" CommandNoBlockThen\n  CommandNoBlockThen = Loop | PlayNoBlockThen\n  PlayNoBlockThen = "play" Fragment (digit+ "times")? InlineThen?\n  BlockThen = "then" newline+ Command\n\n  Fragment = "reversed"? ident track?\n\n  ident = letter (alnum | "_")*\n  space := " " | "\\t"\n  newline = comment? "\\n"\n  comment = spaces "#" (~"\\n" any)*\n}\n'),f=d.createSemantics().addOperation("ast",{Composition:function(n,e){var t=e.children.map((function(n){return n.ast()}));return{settings:t.filter((function(n){return"set"===n.type})),sections:t.filter((function(n){return"instrument"===n.type||"arrangement"===n.type}))}},Instrument:function(n,e,t){var r=n.ast();return{type:"instrument",instrument:r.instrument,name:r.name,tracks:t.ast().flat()}},TrackList:function(n,e,t){return[n.ast()].concat(Object(p.a)(t.ast()))},track:function(n,e,t){return e.sourceString.replaceAll("|","")},instrumentHeader:function(n,e,t,r,a){return{name:e.sourceString,instrument:r.sourceString}},Statement:function(n,e){return n.ast()},set:function(n,e,t,r,a,i,o){switch(t.sourceString){case"bpm":return{type:"set",param:"bpm",value:Number(o.sourceString)};case"key":return{type:"set",param:"key",value:o.sourceString};default:throw new Error("bpm or key expected")}},Arrangement:function(n,e,t){return{type:"arrangement",name:n.ast().name,commands:t.ast().flat()}},CommandList:function(n,e,t){return[n.ast()].concat(Object(p.a)(t.ast()))},arrangementHeader:function(n,e,t){return{name:e.sourceString}},Play:function(n,e,t,r,a,i,o){return{type:"play",times:t.sourceString?parseInt(t.sourceString):1,source:e.ast(),inlineThen:a.sourceString?a.ast()[0]:void 0,blockThen:o.sourceString?o.ast()[0]:void 0}},PlayNoBlockThen:function(n,e,t,r,a){return{type:"play",times:t.sourceString?parseInt(t.sourceString):1,source:e.ast(),inlineThen:a.sourceString?a.ast()[0]:void 0,blockThen:void 0}},InlineThen:function(n,e){return e.ast()},BlockThen:function(n,e,t){return t.ast()},Loop:function(n,e){return{type:"loop",source:e.ast()}},Fragment:function(n,e,t){return t.sourceString?{type:"inline_track",instrument:e.sourceString,track:t.ast()[0],reversed:!!n.sourceString}:{type:"section",name:e.sourceString,reversed:!!n.sourceString}}});var y=function(n){var e;try{e=d.match(n)}catch(t){return null}return e.succeeded()?f(e).ast():(console.log(d.trace(n).toString()),null)};var g=function(n){var e=y(n);if(!e)return{error:!0,message:"syntax error"};var t=e.sections.find((function(n){return"main"===n.name}));if(!t)return{error:!0,message:"no main/"};if("arrangement"!==t.type)return{error:!0,message:"main/ must be arrangement"};var r=e.settings.find((function(n){return"bpm"===n.param})),a={},i=e.sections.reduce((function(n,e){return a[e.name]?{error:!0,message:'multiple sections named "'.concat(e.name,'"')}:(a[e.name]=e,n)}),null);return i||{error:!1,main:t,sections:a,bpm:(null===r||void 0===r?void 0:r.value)||120}},k=t(10),v=t(0),b=t(1),S=(new k.a).toDestination(),j=new k.b({urls:{A1:"kick.mp3",A2:"snare.mp3",A3:"hihat.mp3"},baseUrl:"https://tonejs.github.io/audio/drum-samples/breakbeat8/"}).toDestination(),w=function(){function n(e,t,r,a,i){Object(v.a)(this,n),this.track=void 0,this.instrument=void 0,this.reversed=void 0,this.completionCallback=void 0,this.note=void 0,this.loop=void 0,this.currentLoop=void 0,this.complete=void 0,this.track=e.split(""),this.instrument=t,this.reversed=r,this.completionCallback=a,this.loop=i,this.complete=!1,this.note=0,this.currentLoop=this.loop}return Object(b.a)(n,[{key:"reset",value:function(){this.complete=!1,this.note=0,this.currentLoop=this.loop}},{key:"play",value:function(n){var e=(this.reversed?this.track.reverse():this.track)[this.note];if("-"!==e&&"."!==e){if("synth"===this.instrument)S.triggerAttackRelease("".concat(e,"4"),"4n",n);else{var t="k"===e?"A1":"s"===e?"A2":"A3";j.triggerAttackRelease(t,"4n",n)}}this.note=(this.note+1)%this.track.length,0===this.note&&("number"===typeof this.currentLoop&&(this.currentLoop-=1),0!==this.currentLoop&&!1!==this.currentLoop||(this.complete=!0,this.completionCallback()))}},{key:"stop",value:function(){this.complete=!0}}]),n}(),C=function(){function n(e){Object(v.a)(this,n),this.composition=void 0,this.playbacks=void 0,this.composition=e,this.playbacks=[]}return Object(b.a)(n,[{key:"play",value:function(){var n=this;k.c.bpm.value=this.composition.bpm,this.playSection(this.composition.main,1,(function(){console.log("done")})),k.c.scheduleRepeat((function(e){n.playbacks.forEach((function(n){n.complete||n.play(e+.1)}))}),"4n"),k.c.start()}},{key:"playSection",value:function(n,e,t){var r=this,a=function(){!0===e?i.forEach((function(n){return n.reset()})):!1===e||0===(e-=1)?(i.forEach((function(n){return n.stop()})),t()):i.forEach((function(n){return n.reset()}))},i=n.commands.flatMap((function(n){return r.playCommand(n,a)}));return i}},{key:"playCommand",value:function(n,e){var t=this,r=n.source,a="loop"===n.type||n.times,i=function(){if("play"===n.type){var r=function(){e(),n.blockThen&&t.playCommand(n.blockThen,(function(){}))};n.inlineThen?t.playCommand(n.inlineThen,r):r()}};if("inline_track"===r.type){var o=new w(r.track,r.instrument,r.reversed,i,a);return this.playbacks.push(o),[o]}var s=this.composition.sections[r.name];if("arrangement"===s.type)return this.playSection(s,a,i);var c,u=s.tracks.map((function(n){return new w(n,s.instrument,r.reversed,i,a)}));return(c=this.playbacks).push.apply(c,Object(p.a)(u)),u}}]),n}();var T=function(n){new C(n).play()},O=t(12),x=m.a.main.withConfig({displayName:"App__Main",componentId:"sc-1hxgy29-0"})(["display:flex;width:100%;height:100%;"]),L=m.a.textarea.withConfig({displayName:"App__Editor",componentId:"sc-1hxgy29-1"})(["flex:2;flex-shrink:0;padding:1rem;"]),A=m.a.div.withConfig({displayName:"App__Preview",componentId:"sc-1hxgy29-2"})(["flex:1;padding:2rem;"]),I='set bpm to 180\n\n#\n# all tracks in an instrument section play simultaneously\n# use . for rests\n#\nchords/synth\n|c...|g...|\n|e...|b...|\n|g...|d...|\n\n#\n# "kit" instrument currently only has:\n# h (hihat), k (kick), and s (snare)\n#\nbeat/kit\n|hhhh|\n|k.k.|\n|..s.|..ss|\n\nmelody/synth\n|..ab|..dd|eg..|geab|\n\n#\n# arrangement sections can trigger instrument sections or other arrangement sections\n# like instrument sections, all lines in an arrangement section play simultaneously\n#\nintro/\nloop chords\nloop kit|k.h.| # inline tracks are possible, too\nplay reversed melody\n\nmain_loop/\nloop beat\nloop chords\nloop melody\n\n#\n# the "main" arrangement section automatically runs when you hit play\n# you can use "then" to sequence parts of the section\n#\nmain/\nplay intro 2 times then play chords\nthen\nloop main_loop\n',_=g(I);var B=function(){var n=Object(r.useState)(!1),e=Object(l.a)(n,2),t=e[0],a=e[1],i=Object(r.useState)(I),o=Object(l.a)(i,2),s=o[0],m=o[1],p=Object(r.useState)(!1),h=Object(l.a)(p,2),d=h[0],f=h[1],y=Object(r.useState)(_),v=Object(l.a)(y,2),b=v[0],S=v[1],j=function(){var n=Object(u.a)(c.a.mark((function n(){return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=6;break}k.c.stop(),k.c.cancel(),a(!1),n.next=11;break;case 6:if(d){n.next=9;break}return n.next=9,k.d();case 9:f(!0),b.error||(T(b),a(!0));case 11:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return Object(O.jsxs)(x,{children:[Object(O.jsx)(L,{value:s,onChange:function(n){t&&j(),m(n.target.value);var e=g(n.target.value+"\n");S(e)},autoCorrect:"none",autoComplete:"none"}),Object(O.jsxs)(A,{children:[Object(O.jsx)("button",{onClick:j,children:t?"stop":"play"}),b.error&&b.message]})]})},F=function(n){n&&n instanceof Function&&t.e(3).then(t.bind(null,103)).then((function(e){var t=e.getCLS,r=e.getFID,a=e.getFCP,i=e.getLCP,o=e.getTTFB;t(n),r(n),a(n),i(n),o(n)}))};o.a.render(Object(O.jsx)(a.a.StrictMode,{children:Object(O.jsx)(B,{})}),document.getElementById("root")),F()},45:function(n,e,t){}},[[102,1,2]]]);
//# sourceMappingURL=main.8a510e17.chunk.js.map