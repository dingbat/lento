(this.webpackJsonplento=this.webpackJsonplento||[]).push([[0],{121:function(n,e,t){"use strict";t.r(e);var r=t(17),a=t.n(r),o=t(53),i=t.n(o),s=(t(64),t(9)),c=t.n(s),u=t(13),l=t(14),m=t(32),p=t(12),h=t(30),d=t.n(h).a.grammar('Lento {\n  Composition = newline* Statement*\n  Statement = (set | Section) newline+\n\n  set = "set" space+ settings space+ "to" space+ alnum+\n\n  Section = Instrument | Arrangement\n\n  Instrument = instrumentHeader (newline+ TrackList)?\n  instrumentHeader = spaces ident "/" ident spaces\n  TrackList = track (newline+ track)*\n  track = "|" ((~("|" | newline) any)* "|")*\n\n  Arrangement = arrangementHeader (newline+ CommandList)?\n  arrangementHeader = spaces ident "/"\n  CommandList = Command (newline+ Command)*\n  Command = Loop | Play\n  Loop = "loop" Fragment\n  Play = "play" Fragment times? InlineThen? (newline+ BlockThen)?\n  InlineThen = "then" CommandNoBlockThen\n  CommandNoBlockThen = Loop | PlayNoBlockThen\n  PlayNoBlockThen = "play" Fragment times? InlineThen?\n  BlockThen = "then" newline+ CommandList\n\n  Fragment = "reversed"? ident track?\n\n  times = (digit+ space "times")\n  ident = (~ reserved) letter (alnum | "_")*\n  space := " " | "\\t"\n  newline = comment? "\\n"\n  comment = spaces "#" (~"\\n" any)*\n  settings = "bpm" | "key"\n  reserved = "loop" | "play" | "then" | "reversed" | "set" | "to" | "times" | settings\n}\n'),f=d.createSemantics().addOperation("ast",{Composition:function(n,e){var t=e.children.map((function(n){return n.ast()}));return{settings:t.filter((function(n){return"set"===n.type})),sections:t.filter((function(n){return"instrument"===n.type||"arrangement"===n.type}))}},Instrument:function(n,e,t){var r=n.ast();return{type:"instrument",instrument:r.instrument,name:r.name,tracks:t.ast().flat()}},TrackList:function(n,e,t){return[n.ast()].concat(Object(p.a)(t.ast()))},track:function(n,e,t){return e.sourceString.replaceAll("|","")},instrumentHeader:function(n,e,t,r,a){return{name:e.sourceString,instrument:r.sourceString}},Statement:function(n,e){return n.ast()},set:function(n,e,t,r,a,o,i){switch(t.sourceString){case"bpm":return{type:"set",param:"bpm",value:Number(i.sourceString)};case"key":return{type:"set",param:"key",value:i.sourceString};default:throw new Error("bpm or key expected")}},Arrangement:function(n,e,t){return{type:"arrangement",name:n.ast().name,commands:t.ast().flat()}},CommandList:function(n,e,t){return[n.ast()].concat(Object(p.a)(t.ast()))},arrangementHeader:function(n,e,t){return{name:e.sourceString}},Play:function(n,e,t,r,a,o){return{type:"play",times:t.sourceString?parseInt(t.sourceString):1,source:e.ast(),inlineThen:r.sourceString?r.ast()[0]:void 0,blockThen:o.sourceString?o.ast()[0]:void 0}},PlayNoBlockThen:function(n,e,t,r){return{type:"play",times:t.sourceString?parseInt(t.sourceString):1,source:e.ast(),inlineThen:r.sourceString?r.ast()[0]:void 0,blockThen:void 0}},InlineThen:function(n,e){return e.ast()},BlockThen:function(n,e,t){return t.ast().flat()},Loop:function(n,e){return{type:"loop",source:e.ast()}},Fragment:function(n,e,t){return t.sourceString?{type:"inline_track",instrument:e.sourceString,track:t.ast()[0],reversed:!!n.sourceString}:{type:"section",name:e.sourceString,reversed:!!n.sourceString}}});var y=function(n){var e;try{e=d.match(n)}catch(t){return{ast:null,error:t.message}}return e.succeeded()?{ast:f(e).ast(),error:null}:{ast:null,error:e.message||""}};function k(n,e,t){return e.reduce((function(e,t){if("inline_track"===t.source.type)return e;var r=n[t.source.name];return r?("arrangement"===r.type&&(e=k(n,r.commands,e)),"play"===t.type&&(t.inlineThen&&(e=k(n,[t.inlineThen],e)),t.blockThen&&(e=k(n,t.blockThen,e))),e):{error:!0,message:'section "'.concat(t.source.name,'" not defined')}}),t||null)}function g(n){n.forEach((function(n){"play"===n.type&&(n.inMain=!0,n.inlineThen&&g([n.inlineThen]),n.blockThen&&g(n.blockThen))}))}var b=function(n){var e=y(n),t=e.ast,r=e.error;if(!t)return{error:!0,message:"syntax error: "+r};var a=t.sections.find((function(n){return"main"===n.name}));if(!a)return{error:!0,message:"no main/"};if("arrangement"!==a.type)return{error:!0,message:"main/ must be arrangement"};var o=t.settings.find((function(n){return"bpm"===n.param})),i={},s=t.sections.reduce((function(n,e){return i[e.name]?{error:!0,message:'multiple sections named "'.concat(e.name,'"')}:(i[e.name]=e,n)}),null);if(s)return s;g(a.commands);var c=k(i,a.commands);return c||{error:!1,main:a,sections:i,bpm:(null===o||void 0===o?void 0:o.value)||120}},v=t(26),j=t(0),S=t(1),T=(new v.a).toDestination(),w=new v.b({urls:{A1:"kick.mp3",A2:"snare.mp3",A3:"hihat.mp3"},baseUrl:"https://tonejs.github.io/audio/drum-samples/breakbeat8/"}).toDestination(),C=function(){function n(e,t,r,a,o){Object(j.a)(this,n),this.track=void 0,this.instrument=void 0,this.completionCallback=void 0,this.note=void 0,this.loop=void 0,this.currentLoop=void 0,this.complete=void 0,this.track=e.split(""),r&&(this.track=this.track.reverse()),this.instrument=t,this.completionCallback=a,this.loop=o,this.complete=!1,this.note=0,this.currentLoop=this.loop}return Object(S.a)(n,[{key:"reset",value:function(){this.complete=!1,this.note=0,this.currentLoop=this.loop}},{key:"play",value:function(n){var e=this.track[this.note];if("-"!==e&&"."!==e){if("synth"===this.instrument)T.triggerAttackRelease("".concat(e,"4"),"4n",n);else{var t="k"===e?"A1":"s"===e?"A2":"A3";w.triggerAttackRelease(t,"4n",n)}}this.note=(this.note+1)%this.track.length,0===this.note&&("number"===typeof this.currentLoop&&(this.currentLoop-=1),(this.currentLoop<=0||!1===this.currentLoop)&&(this.complete=!0))}},{key:"stop",value:function(){this.complete=!0}}]),n}(),O=function(){function n(e){Object(j.a)(this,n),this.composition=void 0,this.playbacks=void 0,this.composition=e,this.playbacks=[]}return Object(S.a)(n,[{key:"play",value:function(n){var e=this;v.c.bpm.value=this.composition.bpm,this.playSection(this.composition.main,1,!1,n,!0),v.c.scheduleRepeat((function(n){var t=[];e.playbacks.forEach((function(e){e.complete||(e.play(n+.1),e.complete&&t.push(e.completionCallback))})),t.forEach((function(n){return n()}))}),"4n"),v.c.start()}},{key:"playSection",value:function(n,e,t,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.playCommands(n.commands,e,t,r,a)}},{key:"playCommands",value:function(n,e,t,r){var a=this,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=function(){s.every((function(n){return!o&&!0===n.loop||n.complete}))&&("number"===typeof e&&(e-=1),!0===e?s.forEach((function(n){return n.reset()})):!1===e||e<=0?(s.forEach((function(n){return n.stop()})),r()):s.forEach((function(n){return n.reset()})))},s=n.flatMap((function(n){return a.playCommand(n,t,i)}));return s}},{key:"playCommand",value:function(n,e,t){var r=this,a=n.source;e=e?!a.reversed:a.reversed;var o="loop"===n.type||n.times,i=function(){if("play"===n.type){var e=function(){n.blockThen?r.playCommands(n.blockThen,!1,!1,t,n.inMain):t()};n.inlineThen?r.playCommand(n.inlineThen,!1,e):e()}};if("inline_track"===a.type){var s=new C(a.track,a.instrument,e,i,o);return this.playbacks.push(s),[s]}var c=this.composition.sections[a.name];if("arrangement"===c.type)return this.playSection(c,o,e,i);var u,l=c.tracks.map((function(n){return new C(n,c.instrument,e,i,o)}));return(u=this.playbacks).push.apply(u,Object(p.a)(l)),l}}]),n}();var x=function(n,e){new O(n).play(e)},L=t(6),A=t(59),I=t(10),_=t(38),E=t(55),N=t(54).a.define({languageData:{commentTokens:{line:"#"}},token:function(n){var e="",t=n.string.substring(0,n.pos),r=t.match(/(^| )$/);return r&&n.match(/^(loop|play|set|to)( |$)/)?(n.backUp(1),e="keyword"):r&&n.match(/^then( |$)/)?(n.backUp(1),e="strong"):r&&n.match(/^\d+ times/)||r&&n.match(/reversed( |$)/)?(n.backUp(1),e="bool"):t.match(/ *set +$/)?n.match(/^[a-z]+/):t.match(/ +to +$/)&&n.match(/^[^# ]*/)?(n.backUp(1),e="character"):n.match(/^#.*/)?e="comment":t.match(/\|$/)&&n.match(/^[^|#]+\|/)?(e="labelName",n.backUp(1)):n.match(/^\|/)?(e="meta",n.backUp(1)):n.match(/^[^/]+\//)?(n.backUp(2),e="strong"):t.match(/\/$/)&&n.match(/^[^#]+/)?(n.backUp(1),e="emphasis"):t.match(/^[^|]*$/)&&n.match(/^[^ |]+ *\|/)&&(n.backUp(2),e="emphasis"),n.next(),e}});var B=t(23),U=m.a.main.withConfig({displayName:"App__Main",componentId:"sc-1hxgy29-0"})(["display:flex;width:100%;height:100%;"]),F=m.a.div.withConfig({displayName:"App__Editor",componentId:"sc-1hxgy29-1"})(["flex:2;flex-shrink:0;"]),P=m.a.div.withConfig({displayName:"App__Preview",componentId:"sc-1hxgy29-2"})(["flex:1;padding:2rem;background-color:rgb(30,30,30);"]),$=m.a.div.withConfig({displayName:"App__SyntaxError",componentId:"sc-1hxgy29-3"})(["color:red;"]),H='set bpm to 180\n\n#\n# all tracks in an instrument section play simultaneously\n# use . for rests\n#\nchords/synth\n|c...|g...|\n|e...|b...|\n|g...|d...|\n\n#\n# "kit" instrument currently only has:\n# h (hihat), k (kick), and s (snare)\n#\nbeat/kit\n|hhhh|\n|k.k.|\n|..s.|..ss|\n\nmelody/synth\n|..ab|..dd|eg..|geab|\n\n#\n# arrangement sections can trigger instrument sections or other arrangement sections\n# like instrument sections, all lines in an arrangement section play simultaneously\n#\nintro/\nloop chords\nloop kit|k.h.| # inline tracks are possible, too\nplay reversed melody\n\nmain_loop/\nloop beat\nloop chords\nloop melody\n\n#\n# the "main" arrangement section automatically runs when you hit play\n# you can use "then" to sequence parts of the section\n#\nmain/\nplay intro 2 times then play chords\nthen\nloop main_loop\n',R=b(H);var D=function(){var n=Object(r.useState)(!1),e=Object(l.a)(n,2),t=e[0],a=e[1],o=Object(r.useState)(!1),i=Object(l.a)(o,2),s=i[0],m=i[1],p=Object(r.useState)(R),h=Object(l.a)(p,2),d=h[0],f=h[1],y=function(){var n=Object(u.a)(c.a.mark((function n(){return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=6;break}v.c.stop(),v.c.cancel(),a(!1),n.next=11;break;case 6:if(s){n.next=9;break}return n.next=9,v.d();case 9:m(!0),d.error||(x(d,(function(){return a(!1)})),a(!0));case 11:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),k=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object(r.useRef)(null),t=Object(r.useRef)(null),a=Object(r.useReducer)((function(e,t){var r=e.update(t).state;return t.docChanged&&n.callback&&n.callback(r.sliceDoc()),r}),void 0,(function(){return L.e.create({doc:n.doc,extensions:[A.a,N,E.a,I.k.of(_.a)]})})),o=Object(l.a)(a,2),i=o[0],s=o[1];return Object(r.useEffect)((function(){if(e.current){t.current?t.current.state!==i&&t.current.setState(i):t.current=new I.d({state:i,dispatch:s,parent:e.current});var n=e.current;return function(){var e;n||(null===(e=t.current)||void 0===e||e.destroy(),t.current=null)}}}),[i]),e}({doc:H,callback:function(n){t&&y();var e=b(n+"\n");f(e)}});return Object(B.jsxs)(U,{children:[Object(B.jsx)(F,{ref:k}),Object(B.jsxs)(P,{children:[Object(B.jsx)("button",{onClick:y,children:t?"stop":"play"}),Object(B.jsx)($,{children:Object(B.jsx)("pre",{children:d.error&&d.message})})]})]})},M=function(n){n&&n instanceof Function&&t.e(3).then(t.bind(null,122)).then((function(e){var t=e.getCLS,r=e.getFID,a=e.getFCP,o=e.getLCP,i=e.getTTFB;t(n),r(n),a(n),o(n),i(n)}))};i.a.render(Object(B.jsx)(a.a.StrictMode,{children:Object(B.jsx)(D,{})}),document.getElementById("root")),M()},64:function(n,e,t){}},[[121,1,2]]]);
//# sourceMappingURL=main.fdca7bab.chunk.js.map